<HTML>
<HEAD>
<TITLE>Tutorial - Unprivileged NFS access</TITLE>
<LINK REV="made" HREF="mailto:satan@fish.com">
</HEAD>
<BODY>

<H1><IMG SRC="../../images/satan.gif">Unprivileged NFS access</H1>

<HR>

<H3>Summary</H3>

NFS server executes requests from unprivileged user programs.

<H3>Impact</H3>

A malicious user can execute NFS file access requests on behalf of any user.

<H3>Background</H3>

When an NFS client host wants to access a remote file or directory, its
operating system sends a request to the NFS server. The request
specifies, among others, a file identifier, the operation (read, write,
change permission, etc.), and the identity of the user on whose behalf
the operation is to be done.

<p>

By default, the user identity is specified with the UNIX numeric user
and group ids.  With this scheme, also called AUTH_UNIX, the server
simply believes anything that the client sends it.

<H3>The problem</H3>

An NFS request is nothing but a network message.  Any user can run a
program that generates arbitrary NFS requests.  Such programs have been
available for several years, and writing them does not require unusual
programming skills.

<p>

When an NFS server accepts requests with AUTH_UNIX authentication from
unprivileged user programs, a malicious user can execute file access
requests on behalf of any user.  Reason: with AUTH_UNIX authentication,
the user identity is nothing but a few user and group ID numbers in a
network message.

<H3>Fix</H3>

The fix is to avoid AUTH_UNIX authentication and to use something that
involves cryptography. For example, secure NFS with DES or Kerberos
credentials. Unfortunately, many NFS implementations support AUTH_UNIX
authentication only. Consult your system documentation.

<p>

A partial, but more common, solution is to configure the NFS server,
and where possible, the mount daemon, to accept requests only from
privileged system programs (such as UNIX kernels), and to reject NFS
requests that are sent by unprivileged user programs.

<p>

<ul>

<li>SunOS 4 administrators modify <tt>/etc/rc.local</tt>

<ul>

<li><tt>rpc.mountd</tt> (no -n option)

<li><tt>echo "nfs_portmon/W1" | adb -w /vmunix /dev/kmem</tt>

</ul>

<p>

<li>SunOS 5 administrators modify <tt>/etc/system</tt>

<ul>

<li><tt>set nfs:nfs_portmon = 1</tt>

</ul>

</ul>

<p>

On other systems, the mountd command-line options differ, and the
kernel variable may be called <em>nfsportmon</em> or something
similar.

<p>

<strong>Note: rejecting NFS requests from unprivileged user programs
does not protect your servers against malicious superusers or against
malicious PC programs.</strong>

<H3>Other tips</H3>

<ul>

<li>Where practical, export file systems read-only.

<li>Consider blocking ports 2049 (nfs) and 111 (portmap) on your
routers.

</ul>
</BODY>
</HTML>
